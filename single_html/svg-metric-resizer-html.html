<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG to Real-life Metric Size Converter for CNC</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.5;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }
        h1 {
            font-size: 24px;
            text-align: center;
            margin-bottom: 24px;
            color: #333;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }
        @media (min-width: 768px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .upload-area:hover {
            background-color: #f9f9f9;
        }
        .upload-icon {
            font-size: 48px;
            color: #ccc;
        }
        .filename {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .panel {
            background-color: #f5f5f5;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        .panel h3 {
            font-size: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        .panel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }
        .dimensions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        input[type="number"],
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .input-group {
            display: flex;
        }
        .input-group input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            flex: 1;
        }
        .input-group-append {
            background-color: #eee;
            border: 1px solid #ddd;
            border-left: none;
            padding: 8px;
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
            font-size: 14px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        .checkbox-group input {
            margin-right: 8px;
        }
        .info-text {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
        }
        .button-group {
            display: flex;
            gap: 8px;
        }
        .btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #2563eb;
        }
        .btn-success {
            background-color: #22c55e;
            color: white;
        }
        .btn-success:hover:not(:disabled) {
            background-color: #16a34a;
        }
        .alert {
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 16px;
        }
        .alert-success {
            background-color: #dcfce7;
            color: #166534;
        }
        .alert-danger {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .preview {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .preview-area {
            flex: 1;
            min-height: 300px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
        }
        .preview-note {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }
        .instructions {
            margin-top: 24px;
            font-size: 14px;
            color: #666;
        }
        .instructions h3 {
            font-size: 16px;
            margin-bottom: 8px;
        }
        .instructions ol {
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 4px;
        }
        .hidden {
            display: none;
        }
        .icon {
            margin-right: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SVG to Real-life Metric Size Converter for CNC</h1>
        
        <div class="grid">
            <div>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <p>Click to upload SVG or drag and drop</p>
                    <p style="font-size: 12px; color: #666;">SVG files only</p>
                    <input type="file" id="fileInput" accept=".svg" class="hidden">
                </div>
                
                <div id="filename" class="filename"></div>
                
                <div class="panel" style="margin-top: 16px;">
                    <h3>üìè Current Dimensions</h3>
                    <div class="panel-grid">
                        <div style="font-size: 14px;">
                            <span style="color: #666;">ViewBox Width:</span> 
                            <span id="viewBoxWidth">-</span>
                        </div>
                        <div style="font-size: 14px;">
                            <span style="color: #666;">ViewBox Height:</span> 
                            <span id="viewBoxHeight">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>‚ÜîÔ∏è Target Dimensions</h3>
                    
                    <div class="dimensions-grid">
                        <div>
                            <label for="realWidth">Width</label>
                            <div class="input-group">
                                <input type="number" id="realWidth" value="100" step="0.1" min="0.1">
                                <span class="input-group-append" id="widthUnit">mm</span>
                            </div>
                        </div>
                        
                        <div>
                            <label for="realHeight">Height</label>
                            <div class="input-group">
                                <input type="number" id="realHeight" value="100" step="0.1" min="0.1">
                                <span class="input-group-append" id="heightUnit">mm</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="maintainAspectRatio" checked>
                        <label for="maintainAspectRatio" style="margin-bottom: 0;">
                            Maintain aspect ratio
                        </label>
                    </div>
                    
                    <div class="dimensions-grid">
                        <div>
                            <label for="units">Units</label>
                            <select id="units">
                                <option value="mm">Millimeters (mm)</option>
                                <option value="cm">Centimeters (cm)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="resolution">Resolution (DPI)</label>
                            <input type="number" id="resolution" value="72" min="1">
                        </div>
                    </div>
                    
                    <div class="info-text">
                        <span style="font-weight: 500;">Scale Factor:</span> 
                        <span id="scaleFactor">1.0000</span> <span id="scaleUnit">mm</span>/unit
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="convertBtn" class="btn btn-primary" disabled>
                        <span class="icon">‚¨ÜÔ∏è</span> Convert SVG
                    </button>
                    
                    <button id="downloadBtn" class="btn btn-success" disabled>
                        <span class="icon">üíæ</span> Download for CNC
                    </button>
                </div>
                
                <div id="message" class="alert" style="display: none;"></div>
            </div>
            
            <div class="preview">
                <h3 style="margin-bottom: 8px;">SVG Preview</h3>
                <div class="preview-area" id="previewArea">
                    <p style="color: #ccc; font-size: 14px;">Upload an SVG to see preview</p>
                </div>
                <div class="preview-note">
                    <p>Ready for FlatCAM and CNC machining with correct metric dimensions.</p>
                    <p style="margin-top: 4px;">
                        When importing to FlatCAM, make sure to set the correct units (<span id="noteUnits">mm</span>).
                    </p>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>Instructions:</h3>
            <ol>
                <li>Upload your SVG file by clicking in the upload area</li>
                <li>Set your desired real-world dimensions in <span id="instructionUnits">mm</span></li>
                <li>Click "Convert SVG" to resize the SVG to your specifications</li>
                <li>Download the converted file for use in FlatCAM</li>
                <li>When importing into FlatCAM, ensure the correct unit system is selected</li>
            </ol>
        </div>
    </div>

    <script>
        // DOM elements
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const filename = document.getElementById('filename');
        const viewBoxWidth = document.getElementById('viewBoxWidth');
        const viewBoxHeight = document.getElementById('viewBoxHeight');
        const realWidth = document.getElementById('realWidth');
        const realHeight = document.getElementById('realHeight');
        const maintainAspectRatio = document.getElementById('maintainAspectRatio');
        const units = document.getElementById('units');
        const resolution = document.getElementById('resolution');
        const scaleFactor = document.getElementById('scaleFactor');
        const convertBtn = document.getElementById('convertBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const previewArea = document.getElementById('previewArea');
        const message = document.getElementById('message');
        const widthUnit = document.getElementById('widthUnit');
        const heightUnit = document.getElementById('heightUnit');
        const scaleUnit = document.getElementById('scaleUnit');
        const noteUnits = document.getElementById('noteUnits');
        const instructionUnits = document.getElementById('instructionUnits');

        // State
        let svgContent = '';
        let viewBox = { x: 0, y: 0, width: 100, height: 100 };
        let scale = 1;
        let originalFilename = '';

        // Event listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileUpload);
        realWidth.addEventListener('input', handleWidthChange);
        realHeight.addEventListener('input', handleHeightChange);
        units.addEventListener('change', handleUnitsChange);
        convertBtn.addEventListener('click', convertSVG);
        downloadBtn.addEventListener('click', downloadSVG);

        // Handle drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '#f0f0f0';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.backgroundColor = '';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileUpload({ target: fileInput });
            }
        });

        // Functions
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file || !file.name.toLowerCase().endsWith('.svg')) {
                showMessage('Please select a valid SVG file', 'danger');
                return;
            }
            
            originalFilename = file.name;
            filename.textContent = `File: ${originalFilename}`;
            
            const reader = new FileReader();
            
            reader.onload = (e) => {
                svgContent = e.target.result;
                
                // Extract viewBox from SVG
                const viewBoxMatch = svgContent.match(/viewBox=["']([^"']*)["']/);
                if (viewBoxMatch && viewBoxMatch[1]) {
                    const values = viewBoxMatch[1].split(/[ ,]+/).map(parseFloat);
                    viewBox = {
                        x: values[0],
                        y: values[1],
                        width: values[2],
                        height: values[3]
                    };
                    
                    // Initialize real dimensions based on viewBox
                    realWidth.value = viewBox.width;
                    realHeight.value = viewBox.height;
                } else {
                    // Try to get width and height attributes if viewBox is not present
                    const widthMatch = svgContent.match(/width=["']([^"']*)["']/);
                    const heightMatch = svgContent.match(/height=["']([^"']*)["']/);
                    
                    let width = 100, height = 100;
                    
                    if (widthMatch && widthMatch[1]) {
                        width = parseFloat(widthMatch[1]);
                    }
                    
                    if (heightMatch && heightMatch[1]) {
                        height = parseFloat(heightMatch[1]);
                    }
                    
                    viewBox = { x: 0, y: 0, width, height };
                    realWidth.value = width;
                    realHeight.value = height;
                }
                
                viewBoxWidth.textContent = viewBox.width.toFixed(2);
                viewBoxHeight.textContent = viewBox.height.toFixed(2);
                
                // Update preview
                updatePreview();
                
                // Enable buttons
                convertBtn.disabled = false;
                downloadBtn.disabled = false;
                
                showMessage('SVG loaded successfully', 'success');
                calculateScale();
            };
            
            reader.readAsText(file);
        }
        
        function updatePreview() {
            if (svgContent) {
                previewArea.innerHTML = svgContent;
                const svgElement = previewArea.querySelector('svg');
                if (svgElement) {
                    svgElement.style.maxWidth = '100%';
                    svgElement.style.maxHeight = '300px';
                }
            } else {
                previewArea.innerHTML = '<p style="color: #ccc; font-size: 14px;">Upload an SVG to see preview</p>';
            }
        }
        
        function handleWidthChange() {
            const width = parseFloat(realWidth.value);
            
            if (maintainAspectRatio.checked && viewBox.width && viewBox.height) {
                const aspectRatio = viewBox.width / viewBox.height;
                realHeight.value = (width / aspectRatio).toFixed(2);
            }
            
            calculateScale();
        }
        
        function handleHeightChange() {
            const height = parseFloat(realHeight.value);
            
            if (maintainAspectRatio.checked && viewBox.width && viewBox.height) {
                const aspectRatio = viewBox.width / viewBox.height;
                realWidth.value = (height * aspectRatio).toFixed(2);
            }
            
            calculateScale();
        }
        
        function handleUnitsChange() {
            const currentUnit = units.value;
            widthUnit.textContent = currentUnit;
            heightUnit.textContent = currentUnit;
            scaleUnit.textContent = currentUnit;
            noteUnits.textContent = currentUnit;
            instructionUnits.textContent = currentUnit;
        }
        
        function calculateScale() {
            if (viewBox.width && parseFloat(realWidth.value)) {
                // Calculate scale factor (mm per viewBox unit)
                scale = parseFloat(realWidth.value) / viewBox.width;
                scaleFactor.textContent = scale.toFixed(4);
            }
        }
        
        function convertSVG() {
            if (!svgContent) {
                showMessage('Please upload an SVG file first', 'danger');
                return;
            }
            
            try {
                // Calculate pixels to mm conversion
                const pixelsPerMM = parseFloat(resolution.value) / 25.4; // 25.4mm = 1 inch
                const currentUnit = units.value;
                
                // Create a new SVG with real-world dimensions
                let newContent = svgContent;
                
                // Replace or add width attribute
                if (newContent.includes('width=')) {
                    newContent = newContent.replace(/width=["'][^"']*["']/, `width="${realWidth.value}${currentUnit}"`);
                } else {
                    newContent = newContent.replace(/<svg/, `<svg width="${realWidth.value}${currentUnit}"`);
                }
                
                // Replace or add height attribute
                if (newContent.includes('height=')) {
                    newContent = newContent.replace(/height=["'][^"']*["']/, `height="${realHeight.value}${currentUnit}"`);
                } else {
                    newContent = newContent.replace(/<svg/, `<svg height="${realHeight.value}${currentUnit}"`);
                }
                
                // Add a transform to scale the content properly if needed
                if (scale !== 1 && !newContent.includes('transform=')) {
                    newContent = newContent.replace(/<svg([^>]*)>/, `<svg$1><g transform="scale(${scale})">`);
                    newContent = newContent.replace(/<\/svg>/, '</g></svg>');
                }
                
                svgContent = newContent;
                updatePreview();
                
                showMessage(`SVG resized to ${realWidth.value}${currentUnit} x ${realHeight.value}${currentUnit}`, 'success');
            } catch (error) {
                showMessage(`Error: ${error.message}`, 'danger');
            }
        }
        
        function downloadSVG() {
            if (!svgContent) {
                showMessage('No SVG content to download', 'danger');
                return;
            }
            
            const blob = new Blob([svgContent], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            
            // Create a filename with cnc_ prefix
            const downloadFilename = originalFilename 
                ? `cnc_${originalFilename}` 
                : 'cnc_resized.svg';
                
            link.download = downloadFilename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showMessage('SVG downloaded successfully', 'success');
        }
        
        function showMessage(text, type) {
            message.textContent = text;
            message.style.display = 'block';
            
            if (type === 'success') {
                message.className = 'alert alert-success';
            } else if (type === 'danger') {
                message.className = 'alert alert-danger';
            }
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                message.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>